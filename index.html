<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>교회 차량 배차 시스템</title>
    <!-- Tailwind CSS CDN을 사용하여 스타일을 적용합니다. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* 회색 배경 */
        }
        /* 구글 캘린더 iframe의 크기를 조정하여 모바일에서도 크게 보이도록 합니다. */
        .calendar-container {
            width: 100%;
            height: 100vh; /* 화면 높이 전체를 사용 */
            max-height: 800px; /* 최대 높이 설정 */
            overflow: auto; /* 내용이 넘칠 경우 스크롤바 생성 */
        }
        .calendar-iframe {
            width: 100%;
            height: 100%;
            border: 0;
        }
        /* form inputs */
        .form-input {
            @apply block w-full mt-1 p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-6xl mx-auto space-y-8">
        <h1 class="text-3xl md:text-4xl font-bold text-center text-gray-800 mt-4">교회 차량 배차 신청</h1>

        <!-- Google Calendar Display -->
        <div class="calendar-container rounded-xl shadow-xl overflow-hidden">
            <iframe
                src="https://calendar.google.com/calendar/embed?src=10263285edd19de93d9af3612d15a7c464b99f93d10f306e9a8576cbe181efe4@group.calendar.google.com&ctz=Asia%2FSeoul&mode=month"
                class="calendar-iframe"
                frameborder="0"
                scrolling="no"
                title="Google Calendar"
            ></iframe>
        </div>

        <!-- Reservation Form -->
        <div class="bg-white rounded-xl shadow-xl p-6 md:p-10">
            <h2 class="text-2xl font-semibold mb-6 text-gray-800">차량 신청 양식</h2>
            <form id="vehicle-form" action="https://script.google.com/macros/s/AKfycbzpyJY-sVvdfPw1rlM_-HhD0IPFKC9V8zh4JjGrj_dQa1WnLcmxjOvzLJAkKxU7ba7ba7pyg/exec" method="POST">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Applicant Name -->
                    <div>
                        <label for="applicantName" class="block text-sm font-medium text-gray-700">1] 신청자 성함</label>
                        <input type="text" id="applicantName" name="신청자 성함" required class="form-input">
                    </div>

                    <!-- Departure Date and Time -->
                    <div>
                        <label for="departureDateTime" class="block text-sm font-medium text-gray-700">2] 출발 날짜와 시간</label>
                        <input type="datetime-local" id="departureDateTime" name="출발 날짜와 시간" required class="form-input">
                    </div>

                    <!-- Arrival Date and Time -->
                    <div>
                        <label for="arrivalDateTime" class="block text-sm font-medium text-gray-700">3] 도착 날짜와 시간</label>
                        <input type="datetime-local" id="arrivalDateTime" name="도착 날짜와 시간" required class="form-input">
                    </div>

                    <!-- Number of People -->
                    <div>
                        <label for="numberOfPeople" class="block text-sm font-medium text-gray-700">4] 몇 명이 가시나요?</label>
                        <input type="number" id="numberOfPeople" name="몇명이 가시나요" required min="1" class="form-input">
                    </div>

                    <!-- Destination -->
                    <div>
                        <label for="destination" class="block text-sm font-medium text-gray-700">5] 어디로 가시나요?</label>
                        <input type="text" id="destination" name="어디로 가시나요" required class="form-input">
                    </div>

                    <!-- Number of Vans -->
                    <div>
                        <label for="numberOfVans" class="block text-sm font-medium text-gray-700">6] 승합차 몇 대로 필요하신가요?</label>
                        <select id="numberOfVans" name="승합차 몇대로 필요하신가요" required class="form-input">
                            <option value="0">0대</option>
                            <option value="1">1대</option>
                            <option value="2">2대</option>
                            <option value="3">3대</option>
                        </select>
                    </div>

                    <!-- Number of Buses -->
                    <div>
                        <label for="numberOfBuses" class="block text-sm font-medium text-gray-700">7] 버스가 필요하실까요?</label>
                        <select id="numberOfBuses" name="버스가 필요하실까요" required class="form-input">
                            <option value="0">0대</option>
                            <option value="1">1대</option>
                            <option value="2">2대</option>
                        </select>
                    </div>

                    <!-- Purpose -->
                    <div>
                        <label for="purpose" class="block text-sm font-medium text-gray-700">8] 용도가 어떻게 되시나요? 예) 시선부수련회</label>
                        <input type="text" id="purpose" name="용도가 어떻게 되시나요" required class="form-input">
                    </div>
                </div>

                <!-- Guidance and Agreement -->
                <div class="mt-8 border-t border-gray-200 pt-8">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">안내사항 및 동의</h3>
                    <div class="prose prose-sm max-w-none text-gray-600 space-y-4">
                        <p>교회 승합차 예약 및 배차에 대해 안내해 드리겠습니다.<br>교회 차량은 사용 용도에 따라 <strong>교회지원</strong>과 <strong>사용자 부담</strong>으로 구분합니다.</p>
                        <p class="pl-4">
                            <strong>교회지원</strong><br>
                            회/부서/교구/구역에서 봉사와 교회 공식일정을 위한 목적으로 차량 이용 시<br>
                            차량 유류비, 고속도로 톨게이트 비용 교회에서 지원
                        </p>
                        <p class="pl-4">
                            <strong>사용자부담</strong><br>
                            회/부서/교구/구역에서 교회 비공식일정을 위한 목적으로 차량 이용 시<br>
                            차량 유류비, 고속도로 톨게이트 비용 사용자 부담
                        </p>
                        <p class="pl-4 text-sm text-gray-500">
                            ※ 교회 공식일정: 년간/월간 계획 및 교회 소식지에 광고된 교회의 각종 행사나 모임을 말함
                        </p>
                        <p>
                            차량 매뉴얼에 의해 교회 공식일정 및 우선순위에 따라 예약 및 배차가 변경될 경우 바로 연락드리도록 하겠습니다.
                        </p>
                        <p>
                            교회차량관리자 신현구형제 (010-7345-2253)<br>
                            차량배정담당자 (정)윤종식 집사 (010-7172-9401)<br>
                            (부)최상돈 집사 (010-4569-0691)
                        </p>
                    </div>
                    <div class="mt-6 flex items-center">
                        <input type="checkbox" id="agreement" name="동의" required class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                        <label for="agreement" class="ml-2 block text-sm font-medium text-gray-700">
                            위 내용을 확인하였으며, 이에 동의합니다.
                        </label>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="mt-8 flex justify-center">
                    <button type="submit" id="submit-btn" class="w-full sm:w-auto px-6 py-3 text-lg font-bold text-white bg-blue-600 rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition ease-in-out duration-150">
                        신청하기
                    </button>
                </div>
            </form>

            <!-- Submission Status Message -->
            <div id="status-message" class="mt-6 text-center text-sm font-medium hidden"></div>

        </div>
    </div>

    <script>
        // DOMContentLoaded 이벤트 발생 시 JavaScript 코드 실행
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('vehicle-form');
            const submitBtn = document.getElementById('submit-btn');
            const statusMessage = document.getElementById('status-message');

            // 폼 제출 이벤트를 감지합니다.
            form.addEventListener('submit', async function(e) {
                e.preventDefault(); // 기본 폼 제출 동작을 막습니다.

                // 동의 체크박스가 체크되었는지 확인합니다.
                const agreementCheckbox = document.getElementById('agreement');
                if (!agreementCheckbox.checked) {
                    statusMessage.textContent = '신청을 위해 동의 체크박스에 체크해주세요.';
                    statusMessage.className = 'mt-6 text-center text-sm font-medium text-red-500';
                    statusMessage.classList.remove('hidden');
                    return;
                }

                // 폼 데이터를 가져와서 FormData 객체를 만듭니다.
                const formData = new FormData(form);

                // 신청하기 버튼과 상태 메시지를 업데이트합니다.
                submitBtn.disabled = true;
                submitBtn.textContent = '신청 중...';
                statusMessage.textContent = '신청 정보를 제출하고 있습니다. 잠시만 기다려주세요...';
                statusMessage.className = 'mt-6 text-center text-sm font-medium text-blue-600';
                statusMessage.classList.remove('hidden');

                try {
                    // Fetch API를 사용하여 구글 Apps Script URL로 데이터를 전송합니다.
                    const response = await fetch(form.action, {
                        method: 'POST',
                        body: formData
                    });

                    if (response.ok) {
                        // 요청이 성공적으로 완료되었을 경우
                        statusMessage.textContent = '✅ 신청이 성공적으로 접수되었습니다!';
                        statusMessage.className = 'mt-6 text-center text-sm font-medium text-green-600';
                        // 폼을 초기화합니다.
                        form.reset();
                    } else {
                        // 요청에 실패했을 경우
                        const errorText = await response.text();
                        statusMessage.textContent = `🚨 신청 실패: ${errorText}`;
                        statusMessage.className = 'mt-6 text-center text-sm font-medium text-red-600';
                    }
                } catch (error) {
                    // 네트워크 오류 등 예외 처리
                    statusMessage.textContent = `🚨 신청 중 오류가 발생했습니다: ${error.message}`;
                    statusMessage.className = 'mt-6 text-center text-sm font-medium text-red-600';
                } finally {
                    // 제출이 완료되면 버튼 상태를 원래대로 복구합니다.
                    submitBtn.disabled = false;
                    submitBtn.textContent = '신청하기';
                }
            });
        });
    </script>
</body>
</html>
